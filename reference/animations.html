<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Animations - Ambient Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../user/installing.html"><strong aria-hidden="true">1.</strong> Installing</a></li><li class="chapter-item expanded "><a href="../user/setting_up_ide.html"><strong aria-hidden="true">2.</strong> Setting up your IDE</a></li><li class="chapter-item expanded "><a href="../user/overview.html"><strong aria-hidden="true">3.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../user/getting_started.html"><strong aria-hidden="true">4.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../user/running_examples.html"><strong aria-hidden="true">5.</strong> Running examples</a></li><li class="chapter-item expanded "><a href="../user/api.html"><strong aria-hidden="true">6.</strong> API</a></li><li class="chapter-item expanded "><a href="../user/debugging.html"><strong aria-hidden="true">7.</strong> Debugging</a></li><li class="chapter-item expanded "><a href="../user/profiling.html"><strong aria-hidden="true">8.</strong> Profiling</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="../reference/getting_content.html"><strong aria-hidden="true">9.</strong> Getting content</a></li><li class="chapter-item expanded "><a href="../reference/runtime.html"><strong aria-hidden="true">10.</strong> Runtime</a></li><li class="chapter-item expanded "><a href="../reference/project.html"><strong aria-hidden="true">11.</strong> Project</a></li><li class="chapter-item expanded "><a href="../reference/ecs.html"><strong aria-hidden="true">12.</strong> ECS</a></li><li class="chapter-item expanded "><a href="../reference/hierarchies.html"><strong aria-hidden="true">13.</strong> Hierarchies</a></li><li class="chapter-item expanded "><a href="../reference/asset_pipeline.html"><strong aria-hidden="true">14.</strong> Asset pipeline</a></li><li class="chapter-item expanded "><a href="../reference/networking.html"><strong aria-hidden="true">15.</strong> Networking</a></li><li class="chapter-item expanded "><a href="../reference/animations.html" class="active"><strong aria-hidden="true">16.</strong> Animations</a></li><li class="chapter-item expanded "><a href="../reference/audio.html"><strong aria-hidden="true">17.</strong> Audio</a></li><li class="chapter-item expanded "><a href="../reference/ui.html"><strong aria-hidden="true">18.</strong> UI</a></li><li class="chapter-item expanded "><a href="../reference/terminology.html"><strong aria-hidden="true">19.</strong> Terminology</a></li><li class="chapter-item expanded "><a href="../reference/common_pitfalls.html"><strong aria-hidden="true">20.</strong> Common pitfalls</a></li><li class="chapter-item expanded "><a href="../reference/faq.html"><strong aria-hidden="true">21.</strong> FAQ</a></li><li class="chapter-item expanded affix "><li class="part-title">Community</li><li class="chapter-item expanded "><a href="../community/contributing.html"><strong aria-hidden="true">22.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="../community/changelog.html"><strong aria-hidden="true">23.</strong> Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Ambient Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="animations"><a class="header" href="#animations">Animations</a></h1>
<p>See the <a href="https://github.com/AmbientRun/Ambient/tree/main/guest/rust/examples/basics/skinmesh">skinmesh example</a> for a full runable example.</p>
<h2 id="animation-assets"><a class="header" href="#animation-assets">Animation assets</a></h2>
<p>To work with animations, you'll need some animation clips to work with. A good way to get started is
by going to <a href="https://www.mixamo.com/#/">Mixamo</a> and download some characters and animations there.</p>
<p>Put your models and animations in your <code>assets</code> folder in your project, and make sure you have a <code>pipeline.json</code>
which can process models and animations, for instance something like this:</p>
<pre><code class="language-json">{
    &quot;pipeline&quot;: {
        &quot;type&quot;: &quot;Models&quot;
    }
}
</code></pre>
<h3 id="finding-the-clip-urls"><a class="header" href="#finding-the-clip-urls">Finding the clip urls</a></h3>
<p>By running <code>ambient build</code> you build the assets. You can browse the <code>build/assets</code> folder to see what
the build command produced.</p>
<p>If we look at the <a href="https://github.com/AmbientRun/Ambient/tree/main/guest/rust/examples/basics/skinmesh">skinmesh example</a>, you can see that we have an animation called <code>assets/Capoeira.fbx</code>. If you build this project,
you'll see that it produces a file called <code>build/assets/Capoeira.fbx/animations/mixamo.com.anim</code>. If you
remove the <code>build/</code> part of that, you will have the animation clip url; i.e. <code>assets/Capoeira.fbx/animations/mixamo.com.anim</code>.</p>
<h2 id="animation-player"><a class="header" href="#animation-player">Animation player</a></h2>
<p>To play animations, you'll need an <code>AnimationPlayer</code>. The animation player plays a graph of animations nodes;
currently the two nodes that exist are <code>PlayClipFromUrlNode</code> and <code>BlendNode</code>. Here's an example of how to set
it up to play a single animation:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let clip = PlayClipFromUrlNode::new(
    asset::url(&quot;assets/Capoeira.fbx/animations/mixamo.com.anim&quot;).unwrap(),
);
let player = AnimationPlayer::new(&amp;clip);

// Let's load a character model to apply the animation to.
Entity::new()
    .with_merge(make_transformable())
    .with(
        prefab_from_url(),
        asset::url(&quot;assets/Peasant Man.fbx&quot;).unwrap(),
    )
    .with(apply_animation_player(), player.0)
    .spawn();
<span class="boring">}
</span></code></pre></pre>
<p>The same animation player can be attached to multiple models.</p>
<h3 id="blending-animations-together"><a class="header" href="#blending-animations-together">Blending animations together</a></h3>
<p>To blend two animations together you can use the <code>BlendNode</code>:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let capoeira = PlayClipFromUrlNode::new(
    asset::url(&quot;assets/Capoeira.fbx/animations/mixamo.com.anim&quot;).unwrap(),
);
let robot = PlayClipFromUrlNode::new(
    asset::url(&quot;assets/Robot Hip Hop Dance.fbx/animations/mixamo.com.anim&quot;).unwrap(),
);
let blend = BlendNode::new(&amp;capoeira, &amp;robot, 0.3);
let anim_player = AnimationPlayer::new(&amp;blend);
<span class="boring">}
</span></code></pre></pre>
<p>This will blend capoeira (30%) and robot (70%) together, to form one output animation.</p>
<h3 id="masked-blending"><a class="header" href="#masked-blending">Masked blending</a></h3>
<p>It's quite common two want to play one animation for the torso and another for the lower
body of a character model. To achieve this we use masking:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let capoeira = PlayClipFromUrlNode::new(
    asset::url(&quot;assets/Capoeira.fbx/animations/mixamo.com.anim&quot;).unwrap(),
);
let robot = PlayClipFromUrlNode::new(
    asset::url(&quot;assets/Robot Hip Hop Dance.fbx/animations/mixamo.com.anim&quot;).unwrap(),
);
let blend = BlendNode::new(&amp;capoeira, &amp;robot, 0.);
blend.set_mask_humanoid_lower_body(1.);
let anim_player = AnimationPlayer::new(&amp;blend);
<span class="boring">}
</span></code></pre></pre>
<p>This will play the capoeira at the upper body, and the robot dance for the lower body.</p>
<p>The value you pass in is the masked blend weight. In the previous example, we saw that a blend
weight of 0.3 would play 30% of the capoeira animation. The same concept can be applied <em>per-bone</em>
instead. So for instance, setting <code>BlendNode::new(&amp;capoeira, &amp;robot, 0.3)</code> and then
<code>blend.set_mask_humanoid_lower_body(0.9)</code> means that all bones play capoeira 30%, except for the
lower body which plays it 90%.</p>
<h3 id="attaching-things-to-a-skeleton"><a class="header" href="#attaching-things-to-a-skeleton">Attaching things to a skeleton</a></h3>
<p>You can also attach things to a skeleton:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let left_foot = get_bone_by_bind_id(unit_id, &amp;BindId::LeftFoot).unwrap();
let ball = Entity::new()
    .with_merge(make_transformable())
    .with_merge(make_sphere())
    .with(parent(), left_foot)
    .with_default(local_to_parent())
    // Without reset_scale, the ball would take the scale of the
    // bone we're attaching it to
    .with_default(reset_scale())
    .spawn();
add_child(left_foot, ball);
<span class="boring">}
</span></code></pre></pre>
<p>This will spawn a ball and attach it to the left foot of the character.</p>
<h3 id="pre-loading-animations"><a class="header" href="#pre-loading-animations">Pre-loading animations</a></h3>
<p>You can pre-load animations is by simply creating <code>PlayClipFromUrlNode</code> nodes and waiting for them to load:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let capoeira = PlayClipFromUrlNode::new(
    asset::url(&quot;assets/Capoeira.fbx/animations/mixamo.com.anim&quot;).unwrap(),
);
capoeira.wait_until_loaded().await;
<span class="boring">}
</span></code></pre></pre>
<p>The clip will remain loaded as long as the object survives.</p>
<h3 id="retargeting"><a class="header" href="#retargeting">Retargeting</a></h3>
<p>It's possible to play an animation that was made for one character on another character. To make
it look right, you might need to use retargeting though. Try setting retargeting on the <code>PlayClipFromUrlNode</code>.</p>
<h3 id="animation-nodes-lifetimes-and-ownership"><a class="header" href="#animation-nodes-lifetimes-and-ownership">Animation nodes lifetimes and ownership</a></h3>
<p>The animation player and nodes all live in the ECS, and the <code>AnimationPlayer</code> and <code>PlayClipFromUrlNode</code> etc.
are all simple wrappers around an <code>EntityId</code>. To remove an animation player, call <code>player.despawn()</code> on it.</p>
<p>The animation nodes are ref counted, so the will survive as long as they are either being played by an
animation player, or as long as you have a reference to them in your code (i.e. you have an <code>PlayClipFromUrlNode</code>).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/networking.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../reference/audio.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/networking.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../reference/audio.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
